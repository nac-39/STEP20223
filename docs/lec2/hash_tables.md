# ハッシュテーブルの実装

## コードの実行

functional_test, performance_test が実行される。

```bash
$ cd STEP2023
$ python3 lec2/hash_tables.py
```

## 実装する時に考えたこと

### `Hash_Table.delete()`メソッドの実装

- `HashTable.buckets`には`Item`の先頭の要素だけが入っている。
- 消したい`Item`が先頭の時とそうでない時で処理を分けないといけない。

- 参照渡し値渡し（詰まった）  
  hash_tables.py:L133 で「メモ: item には self.buckets[bucket_index]の値が入っているものとして考える。」このように書いているが、本当は item には参照が入っている。  
  例えば、while 文の中で item を次のように new_item で書き換えようとすると、

  ```python
  ...
  new_item = Item("key", "value", None)
  item = new_item
  ```

  この場合は`HashTable.buckets`の中に入っている`item`は書き換えられず、別の領域に新しく`item`が生成される。多分。

  でも、item の next だけを書き換える時は別の領域に`item`を作ることなく、`item.next`の値だけを書き換えている？からうまく動いている？

  どうやら、`item = hoge`と代入すると`item`の id は変わるが、`item.next = hoge`とすると`item`の id は変わらないらしい。

  C や Rust で書けたらここでは悩まないはず………；；

  参考： [https://www.javadrive.jp/python/userfunc/index3.html#section1](https://www.javadrive.jp/python/userfunc/index3.html#section1)

## `performance_test`の結果

速度向上のために何もしてない時

<details>
<summary>結果</summary>

```plaintext
0 0.660312
1 1.095681
2 1.860802
3 2.435335
4 2.555958
5 3.276788
6 4.741652
7 5.478837
8 5.912355
9 6.473634
10 8.073731
11 8.562101
12 10.462486
13 10.963499
14 10.591143
15 11.758178
16 12.265143
17 14.718922
18 14.366009
19 16.448385
20 16.213876
21 17.160734
22 17.496969
23 19.433719
24 19.718676
25 20.826736
26 20.793536
27 23.289840
28 24.698754
29 23.879254
30 25.356521
31 27.880226
32 27.427562
33 29.225758
34 29.759982
35 29.586485
```

</details>

`HashTable.buckets`のサイズを変えるようにした時  
逆に遅くなったが………？？

<details>
<summary>結果</summary>
0 1.574800
1 2.920624
2 3.277485
3 5.196481
4 8.880142
5 1.988053
6 15.133866
7 2.756293
8 27.428764
9 3.131195
10 3.782188
11 49.801697
12 4.942622
13 6.474186
14 7.205083
15 7.929710
16 77.086919
17 7.354232
18 8.338592
19 9.283118
20 10.203802
21 13.038966
22 12.576525
23 127.356637
24 11.320420
25 12.338452
26 13.416994
27 13.978654
28 18.021652
29 16.503718
30 17.598146
31 19.312600
32 230.027086
33 14.765075
34 16.269958
35 17.153248
36 18.833983
37 20.147837
38 21.301383
39 21.458964
40 23.014750
41 24.059343
42 23.638033
43 24.302826
44 25.098593
</details>
